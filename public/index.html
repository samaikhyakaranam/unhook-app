<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Unhook</title>
  <link href="https://fonts.googleapis.com/css2?family=Hanken+Grotesk:wght@400;600;700&family=DM+Sans:wght@400;600;700&family=Poppins:wght@400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet"/>

  <style>
    *{box-sizing:border-box;font-family:var(--app-font,"Hanken Grotesk"),system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    :root{--brand:#002293;--brand-dark:#001b75;--bg1:#f5faff;--bg2:#e3f3ff;--card:#fff;--ink:#0b1b33;--muted:#6b7a90;--ring:rgba(0,34,147,.18)}
    body[data-theme="ocean"]{--bg1:#e8f7ff;--bg2:#cfefff;--brand:#0066cc;--brand-dark:#004b99}
    body[data-theme="sunset"]{--bg1:#fff2e8;--bg2:#ffe1cf;--brand:#ff7a59;--brand-dark:#d55c3e}
    body[data-theme="midnight"]{--bg1:#0e1220;--bg2:#0a0f1a;--card:#11162a;--ink:#dfe7ff;--muted:#9fb1ff;--brand:#5b7cff;--brand-dark:#3e5fe6}
    html,body{height:100%}
    body{margin:0;color:var(--ink);background:linear-gradient(180deg,var(--bg1),var(--bg2))}
    header{background:var(--brand);color:#fff;padding:24px;font-weight:700;font-size:28px;text-align:center;letter-spacing:.2px}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .tabs{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin:14px auto 8px;align-items:center}
    .tab{background:var(--brand);color:#fff;padding:12px 22px;border-radius:999px;cursor:pointer;font-weight:600;box-shadow:0 10px 24px var(--ring);transition:.12s transform,.12s background,.12s box-shadow}
    .tab:hover{background:var(--brand-dark);transform:translateY(-1px)}
    .right{margin-left:auto}
    .pill{background:#eef3ff;color:#2746ff;padding:6px 10px;border-radius:999px;font-weight:700;box-shadow:0 2px 8px var(--ring);display:inline-flex;gap:6px;align-items:center}
    .section{display:none}
    .section.active{display:block;animation:fade .2s ease}
    @keyframes fade{from{opacity:.6;transform:translateY(2px)}to{opacity:1;transform:translateY(0)}}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:860px){.grid-2{grid-template-columns:1fr}}
    .card{background:var(--card);border-radius:16px;box-shadow:0 10px 24px var(--ring);padding:16px;margin:14px 0}
    .card.equal{display:flex;flex-direction:column;min-height:140px}
    h2.section-title{text-align:center;margin:8px 0 14px}
    label{font-weight:600;display:block;margin:4px 2px 8px}
    select,textarea,input[type="text"],input[type="color"]{width:100%;background:#fff;border:1px solid #e7eef8;border-radius:12px;padding:14px;outline:none;box-shadow:0 6px 14px rgba(0,0,0,.04);color:var(--ink)}
    textarea{resize:vertical;min-height:120px}
    .row{margin:14px 0}
    .cta{background:var(--brand);color:#fff;border:0;padding:12px 20px;border-radius:999px;font-weight:700;cursor:pointer;box-shadow:0 10px 24px var(--ring)}
    .cta:hover{background:var(--brand-dark)}
    .cta.ghost{background:transparent;color:var(--brand);border:2px solid var(--brand)}
    .cta.small{padding:8px 14px;font-weight:600}
    .muted{color:var(--muted)}
    .inline{display:inline-flex;gap:10px;align-items:center}
    .flex{display:flex;gap:10px;align-items:center}
    .space-between{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .shop-grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .item-title{font-weight:700}
    .price{color:var(--muted);font-weight:600}
    .link{color:var(--brand);text-decoration:underline;cursor:pointer;font-weight:600}
    .swatches{display:flex;gap:6px;margin:6px 0}
    .sw{width:16px;height:16px;border-radius:4px;border:1px solid #dfe6f5;box-shadow:0 1px 2px rgba(0,0,0,.06)}
    .sticker-peek{font-size:20px;letter-spacing:4px;margin:6px 0}
    .chat-box{height:380px;overflow:auto;border-radius:16px;background:var(--card);box-shadow:inset 0 0 0 1px #e9eef6,0 10px 24px var(--ring);padding:12px}
    .msg{margin:8px 0}
    .msg small{color:var(--muted);font-weight:600;margin-right:6px}
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.35);z-index:50}
    .overlay.show{display:flex}
    .cele-card{background:#fff;border-radius:18px;padding:22px;max-width:520px;width:92%;text-align:center;box-shadow:0 30px 80px rgba(0,0,0,.25);position:relative;overflow:hidden}
    .cele-title{font-size:22px;font-weight:800;margin:6px 0 8px}
    .cele-sub{color:#4a5568;margin:0 0 12px}
    .sparkles{position:absolute;inset:0;pointer-events:none}
    .sparkles span{position:absolute;font-size:24px;opacity:0}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
</head>

<body>
  <header>Unhook: Breaking the Vape</header>

  <div class="tabs wrap">
    <div class="tab" data-go="checkin">Check-In</div>
    <div class="tab" data-go="journal">Journal</div>
    <div class="tab" data-go="motivation">Motivation</div>
    <div class="tab" data-go="shop">Shop</div>
    <div class="tab" data-go="profile">Profile</div>
    <div class="tab" data-go="community">Community</div>
    <div class="pill right" id="coinPill">Coins: <span id="coinCount">0</span></div>
  </div>

  <main class="wrap">
    <section id="checkin" class="section active">
      <h2 class="section-title">Daily Check-In</h2>

      <div class="grid-2">
        <div class="card equal">
          <label>How are you feeling today?</label>
          <select id="moodSel">
            <option value="5">Excellent</option>
            <option value="4" selected>Good</option>
            <option value="3">Okay</option>
            <option value="2">Not great</option>
            <option value="1">Rough</option>
          </select>
        </div>
        <div class="card equal">
          <label>Did you experience cravings today?</label>
          <select id="craveSel">
            <option value="none" selected>No cravings</option>
            <option value="mild">Mild</option>
            <option value="strong">Strong</option>
          </select>
        </div>
      </div>

      <div class="grid-2">
        <div class="card equal">
          <label>What triggered your cravings (if any)?</label>
          <input id="triggerTxt" type="text" placeholder="e.g., stress, boredom, social pressure"/>
        </div>

        <div class="card equal">
          <label>Did you vape today?</label>
          <select id="vapedSel">
            <option value="no" selected>No</option>
            <option value="yes">Yes</option>
          </select>
        </div>
      </div>

      <div class="card">
        <label>Optional notes</label>
        <textarea id="notesTxt" placeholder="Anything else you want to add?"></textarea>
        <div class="space-between" style="margin-top:8px;">
          <div class="inline">
            <button class="cta small ghost" id="clearDraftBtn" type="button">Clear before submitting</button>
          </div>
          <div class="inline">
            <button class="cta" id="saveCheckinBtn">Save Check-In</button>
          </div>
        </div>
      </div>

      <p class="muted" id="checkinMsg" style="text-align:center;"></p>
    </section>

    <section id="journal" class="section">
      <h2 class="section-title">Journal</h2>
      <div class="card">
        <div class="space-between">
          <strong>Prompt</strong>
          <div class="inline">
            <button id="prevPrompt" class="cta small ghost" type="button">‚Ä¢ Prev</button>
            <button id="nextPrompt" class="cta small" type="button">Next ‚Ä¢</button>
          </div>
        </div>
        <p id="promptText" style="margin:10px 0 0;"></p>
      </div>

      <div class="card">
        <div class="space-between">
          <label style="margin:0">Your entry</label>
          <label class="inline" style="margin:0">
            <input type="checkbox" id="freeWriteToggle"/>
            <span class="muted">Free-write (ignore prompt)</span>
          </label>
        </div>
        <textarea id="journalEntry" placeholder="Write what's on your mind‚Ä¶"></textarea>
        <div class="space-between" style="margin-top:10px;">
          <div class="inline">
            <button class="cta small ghost" id="clearJournalDraft" type="button">Clear before saving</button>
          </div>
          <div class="inline">
            <button class="cta" id="saveJournalBtn">Save Entry (+7 coins)</button>
            <span class="muted" id="saveJournalMsg"></span>
          </div>
        </div>
      </div>

      <div class="card" id="journalHistoryCard" style="display:none;">
        <strong>Previous prompts</strong>
        <ul id="journalHistory" class="muted" style="margin:8px 0 0; padding-left:18px;"></ul>
      </div>
    </section>

    <section id="motivation" class="section">
      <h2 class="section-title">Motivation</h2>
      <div class="card">
        <div class="space-between">
          <strong>Choose your style</strong>
          <div class="inline">
            <select id="motivationStyle">
              <option value="gentle">Gentle</option>
              <option value="realtalk">Real Talk</option>
              <option value="mix" selected>Mix</option>
            </select>
            <button id="saveStyleBtn" class="cta small">Save</button>
          </div>
        </div>
      </div>
      <div class="stickies" id="stickyGrid"></div>
    </section>

    <section id="shop" class="section">
      <h2 class="section-title">Shop</h2>
      <p class="muted" style="text-align:center;">Your balance: <strong><span id="shopCoins">0</span> coins</strong></p>
      <div class="shop-grid">
        <div class="card">
          <div class="item-title">Theme: Ocean</div>
          <div class="swatches">
            <div class="sw" style="background:#e8f7ff"></div>
            <div class="sw" style="background:#cfefff"></div>
            <div class="sw" style="background:#0066cc"></div>
            <div class="sw" style="background:#004b99"></div>
          </div>
          <div class="muted">Cool blues for a calm vibe.</div>
          <div class="price">Cost: 35 coins</div>
          <button class="cta buyBtn" data-type="theme" data-key="ocean" data-cost="35">Buy & Apply</button>
        </div>

        <div class="card">
          <div class="item-title">Theme: Sunset</div>
          <div class="swatches">
            <div class="sw" style="background:#fff2e8"></div>
            <div class="sw" style="background:#ffe1cf"></div>
            <div class="sw" style="background:#ff7a59"></div>
            <div class="sw" style="background:#d55c3e"></div>
          </div>
          <div class="muted">Warm oranges/pinks for cozy energy.</div>
          <div class="price">Cost: 35 coins</div>
          <button class="cta buyBtn" data-type="theme" data-key="sunset" data-cost="35">Buy & Apply</button>
        </div>

        <div class="card">
          <div class="item-title">Theme: Midnight</div>
          <div class="swatches">
            <div class="sw" style="background:#0e1220"></div>
            <div class="sw" style="background:#0a0f1a"></div>
            <div class="sw" style="background:#6d8bff"></div>
            <div class="sw" style="background:#4f6af0"></div>
          </div>
          <div class="muted">Dark mode, neon accents.</div>
          <div class="price">Cost: 35 coins</div>
          <button class="cta buyBtn" data-type="theme" data-key="midnight" data-cost="35">Buy & Apply</button>
        </div>

        <div class="card">
          <div class="item-title">Create Your Own Theme</div>
          <div class="muted">Pick your colors. Requires 10 coins OR 2-day streak.</div>
          <div class="row grid-2">
            <div>
              <label>Top gradient</label>
              <input type="color" id="ctBg1" value="#f5faff"/>
            </div>
            <div>
              <label>Bottom gradient</label>
              <input type="color" id="ctBg2" value="#e3f3ff"/>
            </div>
          </div>
          <div class="row grid-2">
            <div>
              <label>Primary</label>
              <input type="color" id="ctBrand" value="#002293"/>
            </div>
            <div>
              <label>Primary (dark)</label>
              <input type="color" id="ctBrandDark" value="#001b75"/>
            </div>
          </div>
          <button class="cta" id="applyCustomThemeBtn">Apply Custom Theme</button>
          <div id="ctMsg" class="muted" style="margin-top:8px;"></div>
        </div>

        <div class="card">
          <div class="item-title">Badge ‚Äì First Week Smoke-Free</div>
          <div class="muted link" data-jump="profile">Show on your profile</div>
          <div class="price">Cost: 50 coins</div>
          <button class="cta buyBtn" data-type="badge" data-key="week1" data-cost="50">Buy</button>
        </div>

        <div class="card">
          <div class="item-title">Badge ‚Äì 1 Month Smoke-Free</div>
          <div class="muted link" data-jump="profile">Show on your profile</div>
          <div class="price">Cost: 100 coins</div>
          <button class="cta buyBtn" data-type="badge" data-key="month1" data-cost="100">Buy</button>
        </div>

        <div class="card">
          <div class="item-title">Badge ‚Äì 6 Months Smoke-Free</div>
          <div class="muted link" data-jump="profile">Show on your profile</div>
          <div class="price">Cost: 300 coins</div>
          <button class="cta buyBtn" data-type="badge" data-key="month6" data-cost="300">Buy</button>
        </div>

        <div class="card">
          <div class="item-title">Badge ‚Äì 1 Year Smoke-Free</div>
          <div class="muted link" data-jump="profile">Show on your profile</div>
          <div class="price">Cost: 500 coins</div>
          <button class="cta buyBtn" data-type="badge" data-key="year1" data-cost="500">Buy</button>
        </div>

        <div class="card">
          <div class="item-title">Sticker Pack ‚Äì ‚ÄúYou got this!‚Äù</div>
          <div class="sticker-peek">üéÉ üï∏Ô∏è üëª üêà‚Äç‚¨õ</div>
          <div class="muted">Attach to entries; cute and encouraging.</div>
          <div class="price">Cost: 10 coins</div>
          <button class="cta buyBtn" data-type="sticker" data-key="pack1" data-cost="10">Buy</button>
        </div>

        <div class="card">
          <div class="item-title">Seasonal Pack ‚Äì Cozy Winter</div>
          <div class="sticker-peek">‚ùÑÔ∏è ‚òÉÔ∏è üß£ ‚òï</div>
          <div class="muted">Limited: hats & accents for your avatar.</div>
          <div class="price">Cost: 5 coins</div>
          <button class="cta buyBtn" data-type="seasonal" data-key="winter24" data-cost="5">Buy</button>
        </div>
      </div>

      <p id="shopMsg" class="muted" style="margin-top:10px;"></p>
    </section>

    <section id="profile" class="section">
      <h2 class="section-title">Your Profile</h2>
      <div class="card">
        <div class="space-between">
          <div class="inline">
            <strong>Current streak:</strong>
            <span><strong><span id="streakDays">0</span></strong> <span id="streakLabel">days</span></span>
          </div>
          <div class="inline">
            <label class="muted" for="fontPicker" style="margin:0">Pick a font:</label>
            <div id="fontPicker" class="font-preview">
              <div class="font-chip" data-font='"Hanken Grotesk"'>Hanken Grotesk</div>
              <div class="font-chip" data-font='"DM Sans"'>DM Sans</div>
              <div class="font-chip" data-font='Poppins'>Poppins</div>
              <div class="font-chip" data-font='"Playfair Display"'>Playfair</div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <strong>Profile picture</strong>
          <p class="muted">Pick an icon you like:</p>
          <div id="pfpGrid" class="pfp-grid"></div>
        </div>
        <div class="card">
          <strong>Badges</strong>
          <div id="badgeGrid" class="badge-grid" style="margin-top:8px;"></div>
        </div>
      </div>
    </section>

    <section id="community" class="section">
      <h2 class="section-title">Community (Anonymous)</h2>
      <div class="card">
        <div class="space-between">
          <label style="margin:0;">Pick a nickname (saved only on this device)</label>
          <div class="inline">
            <input id="nickInput" type="text" placeholder="e.g., skywalker" style="max-width:260px;">
            <button class="cta small" id="saveNickBtn">Save name</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div id="chatBox" class="chat-box"><div class="muted">Chat unavailable (Firebase not initialized).</div></div>
        <div class="flex" style="margin-top:10px;">
          <input id="chatMsg" type="text" placeholder="Type a message‚Ä¶"/>
          <button class="cta" id="sendBtn">Send</button>
        </div>
        <p class="muted" style="margin-top:6px;">Be kind. Don‚Äôt share personal info. Messages are public within this room.</p>
      </div>
    </section>
  </main>

  <div id="celeOverlay" class="overlay" role="dialog" aria-modal="true">
    <div class="cele-card">
      <div class="sparkles" id="sparkles"></div>
      <div class="cele-title" id="celeTitle">Great job!</div>
      <div class="cele-sub" id="celeSub">You stayed vape-free today ‚Äî we‚Äôre proud of you.</div>
      <button id="celeClose" class="cta" style="margin-top:8px;">Close</button>
    </div>
  </div>

  <script defer src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const show = (id) => {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      const next = document.getElementById(id);
      next.classList.add('active');
      gsap.fromTo(next, {opacity:0, y:6}, {opacity:1, y:0, duration:.3, ease:"power1.out"});
      updateCoinDisplays();
      if (id === 'profile'){ renderBadges(); renderPfp(); updateStreakText(); }
      if (id === 'motivation'){ renderStickies(); }
    };
    document.querySelectorAll('.tab').forEach(t => t.addEventListener('click', () => show(t.dataset.go)));
    document.querySelectorAll('.link[data-jump]').forEach(el => el.addEventListener('click', () => show(el.dataset.jump)));

    const store = { get(k,d){ try{return JSON.parse(localStorage.getItem(k)) ?? d} catch{return d} },
                    set(k,v){ localStorage.setItem(k, JSON.stringify(v)) } };

    function coins(){ return Number(store.get('coins',0)) }
    function updateCoinDisplays(){
      const c = coins();
      const el = document.getElementById('coinCount');
      const shop = document.getElementById('shopCoins');
      if (el) el.textContent = c;
      if (shop) shop.textContent = c;
    }
    function animateCoins(from, to){
      const el = document.getElementById("coinCount");
      gsap.fromTo({val: from}, {val: to, duration:.8, onUpdate(){
        el.textContent = Math.floor(this.targets()[0].val);
      }});
      gsap.fromTo("#coinPill", {scale:1}, {scale:1.12, duration:.18, yoyo:true, repeat:1});
    }
    function setCoins(n){ store.set('coins', Math.max(0,n)); updateCoinDisplays(); }
    function addCoins(n){
      const before = coins();
      const after  = Math.max(0, before + n);
      store.set('coins', after);
      animateCoins(before, after);
      updateCoinDisplays();
    }
    function spendCoins(n){ if (coins()>=n){ setCoins(coins()-n); return true } return false; }

    function todayKey(){ return new Date().toISOString().slice(0,10) }
    function updateStreakText(){
      const s = Number(store.get('streak',0));
      document.getElementById('streakDays').textContent = s;
      document.getElementById('streakLabel').textContent = (s===1?'day':'days');
    }

    const celeOverlay = document.getElementById('celeOverlay');
    const celeTitle   = document.getElementById('celeTitle');
    const celeSub     = document.getElementById('celeSub');
    const sparkles    = document.getElementById('sparkles');
    document.getElementById('celeClose').addEventListener('click', () => celeOverlay.classList.remove('show'));
    celeOverlay.addEventListener('click', (e)=>{ if(e.target===celeOverlay) celeOverlay.classList.remove('show'); });

    function sprinkleSparkles() {
      sparkles.innerHTML = '';
      const icons = ['‚ú®','‚≠ê','üîÜ','üíõ','üü°','üèÖ','üí´'];
      for (let i=0;i<18;i++){
        const sp = document.createElement('span');
        sp.textContent = icons[i % icons.length];
        sp.style.left = (Math.random()*100)+'%';
        sp.style.top  = (Math.random()*100)+'%';
        sparkles.appendChild(sp);
        gsap.fromTo(sp, {y:20, opacity:0, scale:0.6}, {y:-10, opacity:1, scale:1, duration:.6, delay:Math.random()*0.3, ease:"back.out(1.7)"});
      }
    }
    function showCelebration({title, sub}){
      celeTitle.textContent = title;
      celeSub.textContent   = sub;
      celeOverlay.classList.add('show');
      sprinkleSparkles();
      confetti({ particleCount: 120, spread: 80, origin: { y: 0.7 } });
      gsap.fromTo('.cele-card', {y:30, opacity:0, scale:.96}, {y:0, opacity:1, scale:1, duration:.28, ease:'power2.out'});
    }

    document.getElementById('clearDraftBtn').addEventListener('click', ()=>{
      document.getElementById('triggerTxt').value='';
      document.getElementById('notesTxt').value='';
      document.getElementById('moodSel').value='4';
      document.getElementById('craveSel').value='none';
      document.getElementById('vapedSel').value='no';
    });

    function alreadyCheckedInToday(){
      const days = store.get('days', {});
      return Boolean(days[todayKey()]);
    }

    document.getElementById('saveCheckinBtn').addEventListener('click', ()=>{
      if (alreadyCheckedInToday()){
        document.getElementById('checkinMsg').textContent = "You already checked in today. Come back tomorrow!";
        return;
      }
      const data = {
        mood: Number(document.getElementById('moodSel').value),
        cravings: document.getElementById('craveSel').value,
        trigger: document.getElementById('triggerTxt').value.trim(),
        vaped: document.getElementById('vapedSel').value,
        notes: document.getElementById('notesTxt').value.trim(),
        ts: Date.now()
      };
      const days = store.get('days', {}); days[todayKey()] = data; store.set('days',days);

      const y = new Date(); y.setDate(y.getDate()-1);
      const hadYesterday = Boolean(days[y.toISOString().slice(0,10)]);
      let streak = Number(store.get('streak',0));
      streak = hadYesterday ? Math.max(1,streak)+1 : 1;
      store.set('streak', streak); updateStreakText();
      gsap.fromTo('#streakDays', {scale:1}, {scale:1.3, duration:.22, yoyo:true, repeat:1, ease:'power1.inOut'});

      let earned = 5; if(data.vaped==='no') earned+=10; if(data.cravings==='none') earned+=5;
      addCoins(earned);

      if(streak===1){ grantBadge('day1','First Day Smoke-Free','Starting is the hardest step ‚Äî you just did it.') }
      if(streak===7) grantBadge('week1','First Week Smoke-Free','Seven days strong. Keep going!');
      if(streak===30) grantBadge('month1','1 Month Smoke-Free','This is a huge milestone. Proud of you!');
      if(streak===180) grantBadge('month6','6 Months Smoke-Free','Half a year! Incredible consistency.');
      if(streak===365) grantBadge('year1','1 Year Smoke-Free','An entire year. You did that.');

      if(streak>=2){ showCelebration({title:"You're on a roll!", sub:`Streak: ${streak} ${(streak===1?'day':'days')}.`}); }
      if(data.vaped==='no'){
        showCelebration({title:"Great job!", sub:`Saved! You earned +${earned} coins.`});
      }else{
        showCelebration({title:"It‚Äôs okay ‚Äî reset starts now", sub:"Slip-ups happen. Breathe. You‚Äôre still in this. Try a deep breath and plan your next win."});
      }

      document.getElementById('checkinMsg').textContent = `Saved! You earned +${earned} coins.`;
      setTimeout(()=>document.getElementById('checkinMsg').textContent='',2500);
    });

    const DEFAULT_PROMPTS = [
      "What made you decide to quit vaping?",
      "Describe a time when you successfully resisted a craving.",
      "What are your top three reasons for wanting to be vape-free?",
      "How do you feel physically and emotionally since quitting vaping?",
      "What strategies have helped you cope with stress without vaping?",
      "Write about a person who supports your decision to quit vaping.",
      "What activities or hobbies have you picked up since quitting?",
      "Describe your ideal vape-free day.",
      "What challenges have you faced while quitting, and how did you overcome them?",
      "How has quitting vaping improved your relationships with others?",
      "Imagine your body's cells cheering you on. What are they saying about your choice to quit?",
      "Describe what true freedom from nicotine addiction feels like. Where are you and what are you doing?",
      "What's one sport, hobby, or creative pursuit that will get significantly better once your lungs are clear?",
      "Write a short letter to your past self who first considered vaping. What warning and encouragement do you give?",
      "List three specific ways quitting will improve your relationships with friends or family.",
      "If you save the money you would have spent on vapes for a year, what exciting thing could you buy or do?",
      "What is the main source of strength (internal or external) you will tap into when a craving is intense?",
      "How does quitting show the world that you are disciplined and in control of your own life?",
      "Describe the feeling of taking a full, deep, easy breath. Make it your motivation.",
      "What new, positive identity are you stepping into by becoming a non-vaper?",
      "Write down your core values (e.g., integrity, health, excellence). How does quitting align with them?",
      "What's one thing you are truly excited about doing once you no longer worry about vaping?",
      "Fill in the blank: I deserve to be nicotine-free because...",
      "Choose a personal quit anthem and write about why its message motivates you.",
      "If you could have a five-minute chat with your future self (vape-free), what advice would they give you?",
      "Name your top three triggers (People, Places, Situations). Plan one avoidance/substitution for each.",
      "What are the 3 P‚Äôs that trigger you most: People, Places, or Patterns?",
      "Write the 5-step distraction routine you'll use immediately when cravings hit.",
      "What feeling (boredom, anxiety, stress) usually comes before you vape? How can you handle it directly?",
      "Design a 'Craving Kit'. What five objects will replace the hand-to-mouth habit?",
      "Write down the exact line you will use to say 'No, thanks' if someone offers you a vape.",
      "What's one thing you can remove from your environment to make quitting easier?",
      "How will you change your routine to disrupt your habit loops?",
      "List three safe people you can text or call when cravings get strong ‚Äî and what you‚Äôll say.",
      "Describe what a craving feels like in your body. Naming it makes it smaller.",
      "What can you hold in your hand instead of a vape?",
      "What will your new after-dinner routine be this week instead of vaping?",
      "List three ways to make your triggers less accessible.",
      "Plan a 'Fire Drill': what‚Äôs your escape plan if you face a sudden trigger?",
      "How does understanding your triggers make you feel stronger?",
      "What is your go-to breathing exercise? Write down the steps.",
      "Write three positive affirmations about your strength.",
      "What‚Äôs a healthy 15-minute activity for nicotine withdrawal mood swings?",
      "Describe a time you overcame a big challenge ‚Äî what skills from then help you now?",
      "If cravings are storm clouds, what‚Äôs your sunshine thought or memory?",
      "What self-care thing will you do today unrelated to quitting?",
      "When boredom hits, what's a task you can switch to that needs full focus?",
      "What‚Äôs the difference between the temporary relief of vaping and the lasting calm of healthier coping?",
      "How can you talk to yourself with kindness instead of self-criticism?",
      "Name one healthy habit you want to add to replace vaping.",
      "Write about an emotion you avoid by vaping. Face it for five minutes today.",
      "What does 'riding the wave' of a craving mean to you?",
      "List five things that bring you genuine joy.",
      "How does movement help release craving energy?",
      "What makes you laugh? Write about a funny memory.",
      "What's the longest time you‚Äôve gone without vaping so far?",
      "List three victories from the past 24 hours.",
      "Describe one positive physical change since cutting back or quitting.",
      "If your journey is climbing a mountain, what milestone are you at?",
      "How does a vape-free day make you feel proud?",
      "How will you reward yourself when you hit a savings goal?",
      "What have you learned about your willpower?",
      "Write a headline for your success story at the end of this week.",
      "What did you accomplish today that old-you couldn't?",
      "Name a craving you beat. What worked?",
      "How has your focus or sleep improved? Give an example?",
      "What‚Äôs your next big reward and what date will you earn it by?",
      "If motivation was a battery, what charged it today?",
      "Who will you tell first when you hit your next milestone?",
      "What was the best positive feedback you've gotten?",
      "Who is your #1 support person? Write a thank-you to them.",
      "How will you clearly ask friends not to vape around you?",
      "Write a supportive message to another teen trying to quit.",
      "What three pieces of advice would you give someone trying to quit?",
      "How does quitting make you a positive influence?",
      "What‚Äôs one new healthy social activity you can try?",
      "List three ways to connect with people without vaping.",
      "How does honesty with a trusted adult lighten your burden?",
      "How would your favorite mentor encourage you today?",
      "What is a healthy boundary sentence you can use?",
      "If you slipped up, what lesson did you learn?",
      "What has been easier than you expected about quitting?",
      "How can you invest vape-saved money into a new hobby?",
      "What logical argument helps when doubt hits?",
      "Rewrite a negative thought into a positive one.",
      "What's one tiny action right now to support your quit?",
      "What good thing came from a tough moment recently?",
      "If you could redo a tough moment today, what would you choose differently?",
      "What unexpected thing triggers you? Be mindful of it.",
      "Write a promise not to let one mistake erase your progress.",
      "Finish the sentence: Today, I choose...",
      "My current superpower is my ability to...",
      "I am strong enough to handle this craving because...",
      "This craving means my body is healing.",
      "The best thing about today was...",
      "I will show myself compassion by...",
      "What mantra will you use when you doubt yourself?",
      "I am worthy of a healthy life because...",
      "I feel the most like myself when...",
      "What's one thing you can let go of today?",
      "I am more than my habit because...",
      "My health is my priority because...",
      "What are you curious to learn or do this week that isn't vape-related?",
      "I forgive myself for past mistakes ‚Äî I focus on today.",
      "My commitment is stronger than any craving.",
      "What are you most looking forward to this weekend?",
      "I am in control of my choices because...",
      "What can you do in the next 5 minutes to feel better right now?",
      "My lungs are strong and getting stronger every day because...",
      "I am a non-vaper. Write a final statement of belief."
    ];

    const PROMPTS = (window.PROMPTS && Array.isArray(window.PROMPTS) && window.PROMPTS.length>0) ? window.PROMPTS : DEFAULT_PROMPTS;

    let promptIndex=0;
    const promptText=document.getElementById('promptText');
    function showPrompt(){ promptText.textContent=PROMPTS[promptIndex]; }
    document.getElementById('prevPrompt').addEventListener('click',()=>{ promptIndex=(promptIndex-1+PROMPTS.length)%PROMPTS.length; showPrompt(); });
    document.getElementById('nextPrompt').addEventListener('click',()=>{ promptIndex=(promptIndex+1)%PROMPTS.length; showPrompt(); });
    showPrompt();

    document.getElementById('clearJournalDraft').addEventListener('click',()=>{ document.getElementById('journalEntry').value=''; });
    document.getElementById('saveJournalBtn').addEventListener('click',()=>{
      const entry=document.getElementById('journalEntry').value.trim();
      if(!entry){ document.getElementById('saveJournalMsg').textContent="Write something first"; return; }
      const free=document.getElementById('freeWriteToggle').checked;
      const hist=store.get('prompt_history',[]);
      if(!free){ const p=PROMPTS[promptIndex]; hist.push(p); store.set('prompt_history',hist); }
      const entries=store.get('journal_entries',[]);
      entries.push({prompt:free?null:PROMPTS[promptIndex],entry,ts:Date.now()});
      store.set('journal_entries',entries);
      document.getElementById('journalEntry').value='';
      document.getElementById('saveJournalMsg').textContent="Saved! +7 coins";
      addCoins(7);
      const ul=document.getElementById('journalHistory'); ul.innerHTML='';
      hist.slice(-10).reverse().forEach(p=>{ const li=document.createElement('li'); li.textContent=p; ul.appendChild(li); });
      document.getElementById('journalHistoryCard').style.display = hist.length?'block':'none';
      setTimeout(()=>document.getElementById('saveJournalMsg').textContent='',1800);
    });

    function owns(type,key){ const arr=store.get('owned_'+type,[]); return arr.includes(key); }
    function addOwned(type,key){
      const arr=store.get('owned_'+type,[]);
      if(!arr.includes(key)){ arr.push(key); store.set('owned_'+type,arr); }
    }

    (function applySavedTheme(){
      const t = store.get('theme',null);
      const custom = store.get('theme_custom',null);
      if(custom){ document.body.removeAttribute('data-theme'); applyCustomThemeVars(custom); }
      else if(t){ document.body.setAttribute('data-theme',t); }
    })();

    document.querySelectorAll('.buyBtn').forEach(b=>{
      b.addEventListener('click',()=>{
        const type=b.dataset.type, key=b.dataset.key, cost=Number(b.dataset.cost);
        if(owns(type,key)){
          document.getElementById('shopMsg').textContent=`You already own this ${type}.`;
          if(type==='theme'){ store.set('theme',key); document.body.setAttribute('data-theme',key); }
          return;
        }
        if(!spendCoins(cost)){ document.getElementById('shopMsg').textContent="Not enough coins."; return; }
        if(type==='theme'){
          store.set('theme_custom',null);
          store.set('theme',key);
          document.body.setAttribute('data-theme',key);
          document.body.style.setProperty('--app-font', store.get('font_choice','"Hanken Grotesk"'));
        }else if(type==='badge'){ addOwned('badge',key); }
        else{ addOwned(type,key); }
        document.getElementById('shopMsg').textContent=`Purchased ${type}!`;
      });
    });

    function applyCustomThemeVars(obj){
      document.body.style.setProperty('--bg1',obj.bg1);
      document.body.style.setProperty('--bg2',obj.bg2);
      document.body.style.setProperty('--brand',obj.brand);
      document.body.style.setProperty('--brand-dark',obj.brandDark);
      store.set('theme',null);
    }
    document.getElementById('applyCustomThemeBtn').addEventListener('click',()=>{
      const canByStreak = Number(store.get('streak',0))>=2;
      const hasCoins = coins()>=10;
      if(!canByStreak && !hasCoins){ document.getElementById('ctMsg').textContent="Need 10 coins or a 2-day streak to apply a custom theme."; return; }
      if(!canByStreak){ setCoins(coins()-10); }
      const custom = {
        bg1:document.getElementById('ctBg1').value,
        bg2:document.getElementById('ctBg2').value,
        brand:document.getElementById('ctBrand').value,
        brandDark:document.getElementById('ctBrandDark').value
      };
      store.set('theme_custom',custom);
      document.body.removeAttribute('data-theme');
      applyCustomThemeVars(custom);
      document.getElementById('ctMsg').textContent="Custom theme applied!";
    });

    const BADGE_META = {
      day1:{name:"First Day Smoke-Free",note:"Starting is the hardest step ‚Äî you just did it."},
      week1:{name:"First Week Smoke-Free",note:"Seven days strong. Keep going!"},
      month1:{name:"1 Month Smoke-Free",note:"Huge milestone. Proud of you!"},
      month6:{name:"6 Months Smoke-Free",note:"Half a year of wins."},
      year1:{name:"1 Year Smoke-Free",note:"An entire year ‚Äî amazing."}
    };
    function grantBadge(key,displayName,note){
      addOwned('badge',key);
      showCelebration({title:`üéâ You unlocked: ${displayName}`, sub:note||BADGE_META[key]?.note||"Nice work!"});
    }
    function renderBadges(){
      const grid=document.getElementById('badgeGrid');
      const owned=store.get('owned_badge',[]);
      grid.innerHTML='';
      if(!owned.length){ grid.innerHTML='<div class="muted">No badges yet. Your first one appears when you check in today.</div>'; return; }
      owned.forEach(k=>{
        const meta=BADGE_META[k]||{name:k,note:""};
        const el=document.createElement('div');
        el.className='badge';
        el.innerHTML=`<div style="font-size:22px;margin-bottom:6px;">üèÖ</div><div><strong>${meta.name}</strong></div><div class="muted" style="font-size:13px">${meta.note||''}</div>`;
        grid.appendChild(el);
      });
    }

    const PFP_CHOICES=["üê∂","üê∞","üê±","ü¶ä","üêª","üêº","üê®","üêµ","ü¶Ñ","üêØ","üêπ","üê∏","üê•","ü¶ã"];
    function renderPfp(){
      const holder=document.getElementById('pfpGrid');
      const sel=store.get('pfp','üê∞');
      holder.innerHTML='';
      PFP_CHOICES.forEach(ch=>{
        const div=document.createElement('div');
        div.className='pfp-choice'+(sel===ch?' active':'');
        div.textContent=ch; div.title='Click to select';
        div.addEventListener('click',()=>{ store.set('pfp',ch); renderPfp(); });
        holder.appendChild(div);
      });
    }

    function applyFontChoice(fontName){ document.documentElement.style.setProperty('--app-font',fontName); store.set('font_choice',fontName); }
    function renderFontPicker(){
      const chips=document.querySelectorAll('.font-chip');
      const chosen=store.get('font_choice','"Hanken Grotesk"');
      applyFontChoice(chosen);
      chips.forEach(c=>{
        c.classList.toggle('active', c.dataset.font===chosen);
        c.addEventListener('click',()=>{
          chips.forEach(x=>x.classList.remove('active'));
          c.classList.add('active'); applyFontChoice(c.dataset.font);
        });
      });
    }

    const STICKIES={
      gentle:["You‚Äôve already proven you can do hard things.","Slip-ups don‚Äôt erase progress. They teach you.","Breathe. This urge will pass.","Talk to yourself like you would to a best friend.","Tiny wins today become big wins later."],
      realtalk:["Wanting and doing are different. Do it.","Cravings last minutes. Pride lasts longer.","You‚Äôre in charge, not the vape.","If it costs your health, it‚Äôs too expensive.","Future you is begging you to keep going."],
      mix:["Reset is always one choice away.","Every check-in is proof you care.","One day at a time beats all-or-nothing.","Replace the habit: move, sip water, breathe.","You‚Äôre stronger than this moment."]
    };
    function renderStickies(){
      const grid=document.getElementById('stickyGrid');
      const style=store.get('motivation_style','mix');
      const picks=[...STICKIES[style],...STICKIES.mix].slice(0,8);
      grid.innerHTML='';
      picks.forEach(txt=>{
        const d=document.createElement('div');
        d.className='sticky '+(style==='realtalk'?'rt':style==='mix'?'mix':'');
        d.textContent=txt;
        grid.appendChild(d);
      });
    }
    document.getElementById('saveStyleBtn').addEventListener('click',()=>{
      const style=document.getElementById('motivationStyle').value;
      store.set('motivation_style',style);
      renderStickies();
    });
    (function initMotivation(){
      const style=store.get('motivation_style','mix');
      document.getElementById('motivationStyle').value=style;
    })();
    let fbReady=false, db=null, chatRef=null;
    const chatBox=document.getElementById('chatBox');
    function setNick(n){ store.set('nick',n||'') }
    function getNick(){ return store.get('nick','') }
    document.getElementById('nickInput').value=getNick();
    document.getElementById('saveNickBtn').addEventListener('click',()=>{ setNick(document.getElementById('nickInput').value.trim()); });

    window.addEventListener('load', ()=>{
      if(!window.firebase){ return; }
      const firebaseConfig={
        apiKey:"AIzaSyAhsjCfr7B-9vxxcA9bnLr46VcxbRMftvA",
        authDomain:"unhook-38abb.firebaseapp.com",
        databaseURL:"https://unhook-38abb-default-rtdb.firebaseio.com",
        projectId:"unhook-38abb",
        storageBucket:"unhook-38abb.firebasestorage.app",
        messagingSenderId:"182531035159",
        appId:"1:182531035159:web:47163c38ee27c2ba3b8c52",
        measurementId:"G-7GGK123MDT"
      };
      try{
        const app=firebase.initializeApp(firebaseConfig);
        db=firebase.database(); chatRef=db.ref('chat/global'); fbReady=true; chatBox.innerHTML="";
        chatRef.limitToLast(100).on('child_added',snap=>{
          const m=snap.val();
          const div=document.createElement('div');
          div.className='msg';
          const when=new Date(m.ts||Date.now()).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
          div.innerHTML=`<small>[${when}] ${escapeHtml(m.nick||'anon')}:</small> ${escapeHtml(m.text||'')}`;
          chatBox.appendChild(div);
          chatBox.scrollTop=chatBox.scrollHeight;
        });
      }catch(e){ console.warn('Firebase init skipped:',e); }
    });

    document.getElementById('sendBtn').addEventListener('click', sendMsg);
    document.getElementById('chatMsg').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); sendMsg(); }});
    function sendMsg(){
      const text=document.getElementById('chatMsg').value.trim(); if(!text) return;
      if(!fbReady||!chatRef){ alert('Chat not ready. Check Firebase config.'); return; }
      const nick=getNick()||'anon';
      chatRef.push({nick,text,ts:Date.now()}).then(()=>{
        document.getElementById('chatMsg').value='';
        const dayKey=todayKey();
        const sent=store.get('msg_count_'+dayKey,0);
        if(sent<3 && text.length>=12){ addCoins(2); store.set('msg_count_'+dayKey, sent+1); }
      }).catch(err=>alert('Send failed: '+err.message));
    }
    function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    (function initUI(){
      updateCoinDisplays();
      updateStreakText();
      renderFontPicker();
      renderBadges();
      renderPfp();
      renderStickies();
      const savedFont=store.get('font_choice','"Hanken Grotesk"');
      document.documentElement.style.setProperty('--app-font',savedFont);
    })();

    document.querySelectorAll('button').forEach(btn=>{
      btn.addEventListener('click',()=>{ gsap.fromTo(btn,{scale:1},{scale:.92,duration:.12,yoyo:true,repeat:1}); });
    });
  });
  </script>
</body>
</html>