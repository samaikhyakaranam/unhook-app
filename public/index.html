<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Unhook</title>
  <link href="https://fonts.googleapis.com/css2?family=Hanken+Grotesk:wght@400;600;700&family=DM+Sans:wght@400;600;700&family=Poppins:wght@400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    *{box-sizing:border-box;font-family:var(--app-font,"Hanken Grotesk"),system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    :root{--brand:#002293;--brand-dark:#001b75;--bg1:#f5faff;--bg2:#e3f3ff;--card:#fff;--ink:#0b1b33;--muted:#6b7a90;--ring:rgba(0,34,147,.18)}
    body[data-theme="ocean"]{--bg1:#e8f7ff;--bg2:#cfefff;--brand:#0066cc;--brand-dark:#004b99}
    body[data-theme="sunset"]{--bg1:#fff2e8;--bg2:#ffe1cf;--brand:#ff7a59;--brand-dark:#d55c3e}
    body[data-theme="midnight"]{--bg1:#0e1220;--bg2:#0a0f1a;--card:#11162a;--ink:#dfe7ff;--muted:#9fb1ff;--brand:#5b7cff;--brand-dark:#3e5fe6}
    html,body{height:100%}
    body{margin:0;color:var(--ink);background:linear-gradient(180deg,var(--bg1),var(--bg2))}
    header{background:var(--brand);color:#fff;padding:24px;font-weight:700;font-size:28px;text-align:center;letter-spacing:.2px}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .tabs{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin:14px auto 8px;align-items:center}
    .tab{background:var(--brand);color:#fff;padding:12px 22px;border-radius:999px;cursor:pointer;font-weight:600;box-shadow:0 10px 24px var(--ring);transition:.12s transform,.12s background,.12s box-shadow}
    .tab:hover{background:var(--brand-dark);transform:translateY(-1px)}
    .right{margin-left:auto}
    .pill{background:#eef3ff;color:#2746ff;padding:6px 10px;border-radius:999px;font-weight:700;box-shadow:0 2px 8px var(--ring);display:inline-flex;gap:10px;align-items:center}
    .auth-user{font-weight:600;color:#1f3fff}
    .section{display:none}
    .section.active{display:block;animation:fade .2s ease}
    @keyframes fade{from{opacity:.6;transform:translateY(2px)}to{opacity:1;transform:translateY(0)}}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:860px){.grid-2{grid-template-columns:1fr}}
    .card{background:var(--card);border-radius:16px;box-shadow:0 10px 24px var(--ring);padding:16px;margin:14px 0}
    .card.equal{display:flex;flex-direction:column;min-height:140px}
    h2.section-title{text-align:center;margin:8px 0 14px}
    label{font-weight:600;display:block;margin:4px 2px 8px}
    select,textarea,input[type="text"],input[type="color"],input[type="email"],input[type="password"]{width:100%;background:#fff;border:1px solid #e7eef8;border-radius:12px;padding:14px;outline:none;box-shadow:0 6px 14px rgba(0,0,0,.04);color:var(--ink)}
    textarea{resize:vertical;min-height:120px}
    .row{margin:14px 0}
    .cta{background:var(--brand);color:#fff;border:0;padding:12px 20px;border-radius:999px;font-weight:700;cursor:pointer;box-shadow:0 10px 24px var(--ring)}
    .cta:hover{background:var(--brand-dark)}
    .cta.ghost{background:transparent;color:var(--brand);border:2px solid var(--brand)}
    .cta.small{padding:8px 14px;font-weight:600}
    .muted{color:var(--muted)}
    .inline{display:inline-flex;gap:10px;align-items:center}
    .flex{display:flex;gap:10px;align-items:center}
    .space-between{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .shop-grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .item-title{font-weight:700}
    .price{color:var(--muted);font-weight:600}
    .link{color:var(--brand);text-decoration:underline;cursor:pointer;font-weight:600}
    .swatches{display:flex;gap:6px;margin:6px 0}
    .sw{width:16px;height:16px;border-radius:4px;border:1px solid #dfe6f5;box-shadow:0 1px 2px rgba(0,0,0,.06)}
    .sticker-peek{font-size:20px;letter-spacing:4px;margin:6px 0}
    .chat-box{height:380px;overflow:auto;border-radius:16px;background:var(--card);box-shadow:inset 0 0 0 1px #e9eef6,0 10px 24px var(--ring);padding:12px}
    .msg{margin:8px 0}
    .msg small{color:var(--muted);font-weight:600;margin-right:6px}
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.35);z-index:50}
    .overlay.show{display:flex}
    .cele-card{background:#fff;border-radius:18px;padding:22px;max-width:520px;width:92%;text-align:center;box-shadow:0 30px 80px rgba(0,0,0,.25);position:relative;overflow:hidden}
    .cele-title{font-size:22px;font-weight:800;margin:6px 0 8px}
    .cele-sub{color:#4a5568;margin:0 0 12px}
    .sparkles{position:absolute;inset:0;pointer-events:none}
    .sparkles span{position:absolute;font-size:24px;opacity:0}
    .badge-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px}
    .pfp-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(58px,1fr));gap:10px}
    .pfp-choice{font-size:36px;line-height:1;background:#fff;border-radius:14px;padding:10px;cursor:pointer;border:2px solid transparent}
    .pfp-choice.active{border-color:var(--brand);box-shadow:0 6px 20px var(--ring)}
    .font-preview{display:flex;gap:8px;flex-wrap:wrap}
    .font-chip{padding:8px 12px;border-radius:999px;border:1px solid #dfe6f5;cursor:pointer}
    .font-chip.active{background:var(--brand);color:#fff;border-color:transparent}
    .auth-bar{display:flex;gap:8px;align-items:center;margin-left:auto}
    .auth-chip{padding:6px 10px;border-radius:999px;border:1px solid #dfe6f5;background:#fff;cursor:pointer;font-weight:600}
    .stickies{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
    .sticky{background:#fff8b8;border:1px solid #f1e28a;border-radius:10px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.08);font-family:"Playfair Display",serif}
    .sticky.firey{background:#ffd2d2;border-color:#ffb2b2}
    .sticky.mix{background:#dff3ff;border-color:#bfe5ff}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
</head>
<body>
  <header>Unhook: Breaking the Vape</header>
  <div class="tabs wrap">
    <div class="tab" data-go="checkin">Check-In</div>
    <div class="tab" data-go="journal">Journal</div>
    <div class="tab" data-go="motivation">Motivation</div>
    <div class="tab" data-go="shop">Shop</div>
    <div class="tab" data-go="profile">Profile</div>
    <div class="tab" data-go="community">Community</div>
    <div class="pill right" id="coinPill">Coins: <span id="coinCount">0</span></div>
    <div class="auth-bar">
      <span id="whoami" class="auth-user">Guest</span>
      <button class="auth-chip" id="btnGoogle">Google</button>
      <button class="auth-chip" id="btnEmail">Email</button>
      <button class="auth-chip" id="btnGuest">Guest</button>
      <button class="auth-chip" id="btnSignOut" style="display:none;">Sign out</button>
    </div>
  </div>
  <main class="wrap">
    <section id="checkin" class="section active">
      <h2 class="section-title">Daily Check-In</h2>
      <div class="grid-2">
        <div class="card equal">
          <label>How are you feeling today?</label>
          <select id="moodSel">
            <option value="5">Excellent</option>
            <option value="4" selected>Good</option>
            <option value="3">Okay</option>
            <option value="2">Not great</option>
            <option value="1">Rough</option>
          </select>
        </div>
        <div class="card equal">
          <label>Did you experience cravings today?</label>
          <select id="craveSel">
            <option value="none" selected>No cravings</option>
            <option value="mild">Mild</option>
            <option value="strong">Strong</option>
          </select>
        </div>
      </div>
      <div class="grid-2">
        <div class="card equal">
          <label>What triggered your cravings (if any)?</label>
          <input id="triggerTxt" type="text" placeholder="e.g., stress, boredom, social pressure"/>
        </div>
        <div class="card equal">
          <label>Did you vape today?</label>
          <select id="vapedSel">
            <option value="no" selected>No</option>
            <option value="yes">Yes</option>
          </select>
        </div>
      </div>
      <div class="card">
        <label>Optional notes</label>
        <textarea id="notesTxt" placeholder="Anything else you want to add?"></textarea>
        <div class="space-between" style="margin-top:8px;">
          <div class="inline">
            <button class="cta small ghost" id="clearDraftBtn" type="button">Clear before submitting</button>
          </div>
          <div class="inline">
            <button class="cta" id="saveCheckinBtn">Save Check-In</button>
          </div>
        </div>
      </div>
      <p class="muted" id="checkinMsg" style="text-align:center;"></p>
    </section>
    <section id="journal" class="section">
      <h2 class="section-title">Journal</h2>
      <div class="card">
        <div class="space-between">
          <strong>Prompt</strong>
          <div class="inline">
            <button id="prevPrompt" class="cta small ghost" type="button">‚Ä¢ Prev</button>
            <button id="nextPrompt" class="cta small" type="button">Next ‚Ä¢</button>
          </div>
        </div>
        <p id="promptText" style="margin:10px 0 0;"></p>
      </div>
      <div class="card">
        <div class="space-between">
          <label style="margin:0">Your entry</label>
          <label class="inline" style="margin:0">
            <input type="checkbox" id="freeWriteToggle"/>
            <span class="muted">Free-write (ignore prompt)</span>
          </label>
        </div>
        <textarea id="journalEntry" placeholder="Write what's on your mind‚Ä¶"></textarea>
        <div class="space-between" style="margin-top:10px;">
          <div class="inline">
            <button class="cta small ghost" id="clearJournalDraft" type="button">Clear before saving</button>
          </div>
          <div class="inline">
            <button class="cta" id="saveJournalBtn">Save Entry (+7 coins)</button>
            <span class="muted" id="saveJournalMsg"></span>
          </div>
        </div>
      </div>
      <div class="card" id="journalHistoryCard" style="display:none;">
        <strong>Previous prompts</strong>
        <ul id="journalHistory" class="muted" style="margin:8px 0 0; padding-left:18px;"></ul>
      </div>
    </section>
    <section id="motivation" class="section">
      <h2 class="section-title">Motivation</h2>
      <div class="card">
        <div class="space-between">
          <strong>Choose your style</strong>
          <div class="inline">
            <select id="motivationStyle">
              <option value="gentle">Gentle</option>
              <option value="firey">Firey</option>
              <option value="mix" selected>Mix</option>
            </select>
            <button id="saveStyleBtn" class="cta small">Save</button>
          </div>
        </div>
      </div>
      <div class="stickies" id="stickyGrid"></div>
    </section>
    <section id="shop" class="section">
      <h2 class="section-title">Shop</h2>
      <p class="muted" style="text-align:center;">Your balance: <strong><span id="shopCoins">0</span> coins</strong></p>
      <div class="shop-grid">
        <div class="card">
          <div class="item-title">Theme: Ocean</div>
          <div class="swatches">
            <div class="sw" style="background:#e8f7ff"></div>
            <div class="sw" style="background:#cfefff"></div>
            <div class="sw" style="background:#0066cc"></div>
            <div class="sw" style="background:#004b99"></div>
          </div>
          <div class="muted">Cool blues for a calm vibe.</div>
          <div class="price">Cost: 35 coins</div>
          <button class="cta buyBtn" data-type="theme" data-key="ocean" data-cost="35">Buy & Apply</button>
        </div>
        <div class="card">
          <div class="item-title">Theme: Sunset</div>
          <div class="swatches">
            <div class="sw" style="background:#fff2e8"></div>
            <div class="sw" style="background:#ffe1cf"></div>
            <div class="sw" style="background:#ff7a59"></div>
            <div class="sw" style="background:#d55c3e"></div>
          </div>
          <div class="muted">Warm oranges/pinks for cozy energy.</div>
          <div class="price">Cost: 35 coins</div>
          <button class="cta buyBtn" data-type="theme" data-key="sunset" data-cost="35">Buy & Apply</button>
        </div>
        <div class="card">
          <div class="item-title">Theme: Midnight</div>
          <div class="swatches">
            <div class="sw" style="background:#0e1220"></div>
            <div class="sw" style="background:#0a0f1a"></div>
            <div class="sw" style="background:#6d8bff"></div>
            <div class="sw" style="background:#4f6af0"></div>
          </div>
          <div class="muted">Dark mode, neon accents.</div>
          <div class="price">Cost: 35 coins</div>
          <button class="cta buyBtn" data-type="theme" data-key="midnight" data-cost="35">Buy & Apply</button>
        </div>
        <div class="card">
          <div class="item-title">Create Your Own Theme</div>
          <div class="muted">Pick your colors. Requires 10 coins OR 2-day streak.</div>
          <div class="row grid-2">
            <div>
              <label>Top gradient</label>
              <input type="color" id="ctBg1" value="#f5faff"/>
            </div>
            <div>
              <label>Bottom gradient</label>
              <input type="color" id="ctBg2" value="#e3f3ff"/>
            </div>
          </div>
          <div class="row grid-2">
            <div>
              <label>Primary</label>
              <input type="color" id="ctBrand" value="#002293"/>
            </div>
            <div>
              <label>Primary (dark)</label>
              <input type="color" id="ctBrandDark" value="#001b75"/>
            </div>
          </div>
          <button class="cta" id="applyCustomThemeBtn">Apply Custom Theme</button>
          <div id="ctMsg" class="muted" style="margin-top:8px;"></div>
        </div>
        <div class="card">
          <div class="item-title">Badge ‚Äì First Week Smoke-Free</div>
          <div class="muted link" data-jump="profile">Show on your profile</div>
          <div class="price">Cost: 50 coins</div>
          <button class="cta buyBtn" data-type="badge" data-key="week1" data-cost="50">Buy</button>
        </div>
        <div class="card">
          <div class="item-title">Badge ‚Äì 1 Month Smoke-Free</div>
          <div class="muted link" data-jump="profile">Show on your profile</div>
          <div class="price">Cost: 100 coins</div>
          <button class="cta buyBtn" data-type="badge" data-key="month1" data-cost="100">Buy</button>
        </div>
        <div class="card">
          <div class="item-title">Badge ‚Äì 6 Months Smoke-Free</div>
          <div class="muted link" data-jump="profile">Show on your profile</div>
          <div class="price">Cost: 300 coins</div>
          <button class="cta buyBtn" data-type="badge" data-key="month6" data-cost="300">Buy</button>
        </div>
        <div class="card">
          <div class="item-title">Badge ‚Äì 1 Year Smoke-Free</div>
          <div class="muted link" data-jump="profile">Show on your profile</div>
          <div class="price">Cost: 500 coins</div>
          <button class="cta buyBtn" data-type="badge" data-key="year1" data-cost="500">Buy</button>
        </div>
        <div class="card">
          <div class="item-title">Sticker Pack ‚Äì ‚ÄúYou got this!‚Äù</div>
          <div class="sticker-peek">üéÉ üï∏Ô∏è üëª üêà‚Äç‚¨õ</div>
          <div class="muted">Attach to entries; cute and encouraging.</div>
          <div class="price">Cost: 10 coins</div>
          <button class="cta buyBtn" data-type="sticker" data-key="pack1" data-cost="10">Buy</button>
        </div>
        <div class="card">
          <div class="item-title">Seasonal Pack ‚Äì Cozy Winter</div>
          <div class="sticker-peek">‚ùÑÔ∏è ‚òÉÔ∏è üß£ ‚òï</div>
          <div class="muted">Limited: hats & accents for your avatar.</div>
          <div class="price">Cost: 5 coins</div>
          <button class="cta buyBtn" data-type="seasonal" data-key="winter24" data-cost="5">Buy</button>
        </div>
      </div>
      <p id="shopMsg" class="muted" style="margin-top:10px;"></p>
    </section>
    <section id="profile" class="section">
      <h2 class="section-title">Your Profile</h2>
      <div class="card">
        <div class="space-between">
          <div class="inline">
            <strong>Current streak:</strong>
            <span><strong><span id="streakDays">0</span></strong> <span id="streakLabel">days</span></span>
          </div>
          <div class="inline">
            <label class="muted" for="fontPicker" style="margin:0">Pick a font:</label>
            <div id="fontPicker" class="font-preview">
              <div class="font-chip" data-font='"Hanken Grotesk"'>Hanken Grotesk</div>
              <div class="font-chip" data-font='"DM Sans"'>DM Sans</div>
              <div class="font-chip" data-font='Poppins'>Poppins</div>
              <div class="font-chip" data-font='"Playfair Display"'>Playfair</div>
            </div>
          </div>
        </div>
      </div>
      <div class="grid-2">
        <div class="card">
          <strong>Profile picture</strong>
          <p class="muted">Pick an icon you like:</p>
          <div id="pfpGrid" class="pfp-grid"></div>
        </div>
        <div class="card">
          <strong>Badges</strong>
          <div id="badgeGrid" class="badge-grid" style="margin-top:8px;"></div>
        </div>
      </div>
    </section>

    <section id="community" class="section">
      <h2 class="section-title">Community (Anonymous)</h2>
      <div class="card">
        <div class="space-between">
          <label style="margin:0;">Pick a nickname (saved only on this device)</label>
          <div class="inline">
            <input id="nickInput" type="text" placeholder="e.g., skywalker" style="max-width:260px;">
            <button class="cta small" id="saveNickBtn">Save name</button>
          </div>
        </div>
      </div>
      <div class="card">
        <div id="chatBox" class="chat-box"><div class="muted">Chat unavailable (Firebase not initialized).</div></div>
        <div class="flex" style="margin-top:10px;">
          <input id="chatMsg" type="text" placeholder="Type a message‚Ä¶"/>
          <button class="cta" id="sendBtn">Send</button>
        </div>
        <p class="muted" style="margin-top:6px;">Be kind. Don‚Äôt share personal info. Messages are public within this room.</p>
      </div>
    </section>
  </main>

  <div id="celeOverlay" class="overlay" role="dialog" aria-modal="true">
    <div class="cele-card">
      <div class="sparkles" id="sparkles"></div>
      <div class="cele-title" id="celeTitle">Great job!</div>
      <div class="cele-sub" id="celeSub">You stayed vape-free today ‚Äî we‚Äôre proud of you.</div>
      <button id="celeClose" class="cta" style="margin-top:8px;">Close</button>
    </div>
  </div>

  <script defer src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>
  <script>
window.addEventListener('DOMContentLoaded',function(){
  const firebaseConfig = {
  apiKey: "AIzaSyAhsjCfr7B-9vxxcA9bnLr46VcxbRMftvA",
  authDomain: "unhook-38abb.firebaseapp.com",
  databaseURL: "https://unhook-38abb-default-rtdb.firebaseio.com",
  projectId: "unhook-38abb",
  storageBucket: "unhook-38abb.firebasestorage.app",
  messagingSenderId: "182531035159",
  appId: "1:182531035159:web:47163c38ee27c2ba3b8c52",
  measurementId: "G-7GGK123MDT"
};

  if(!window.firebase){console.error("Firebase SDK failed to load");return;}
  firebase.initializeApp(firebaseConfig);
  const auth=firebase.auth();
  const db=firebase.database();

  let uid=null;
  let mode=localStorage.getItem("motStyle")||"mix";
  let coins=0;
  let streak=0;
  let nickname=localStorage.getItem("nick")||"";
  const today=new Date().toISOString().split("T")[0];

  function guestId(){let g=localStorage.getItem("guest");if(!g){g="guest_"+Math.random().toString(36).slice(2);localStorage.setItem("guest",g)}return g}
  function setUID(u){uid=u?u.uid:guestId();document.getElementById("nickInput").value=nickname}

  auth.onAuthStateChanged(u=>{setUID(u);updateAuthUI(u);loadUserData();loadChat();});
  function signInGoogle(){auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());}
  function signInEmail(email,pwd){auth.signInWithEmailAndPassword(email,pwd).catch(()=>auth.createUserWithEmailAndPassword(email,pwd));}
  function guest(){setUID(null);updateAuthUI(null);loadUserData();loadChat();}
  function updateAuthUI(u){document.getElementById("whoami").textContent=u?(u.displayName||u.email||"Signed in"):"Guest";document.getElementById("btnSignOut").style.display=u?"inline-flex":"none"}

  document.getElementById("btnGoogle").onclick=signInGoogle;
  document.getElementById("btnEmail").onclick=()=>{const e=prompt("Email");if(!e)return;const p=prompt("Password");if(!p)return;signInEmail(e,p)};
  document.getElementById("btnGuest").onclick=guest;
  document.getElementById("btnSignOut").onclick=()=>auth.signOut();

  function show(id){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));const next=document.getElementById(id);if(next){next.classList.add('active');gsap.fromTo(next,{opacity:0,y:6},{opacity:1,y:0,duration:.28})}}
  document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>show(t.dataset.go)));

  function animateCoins(newTotal){
    const el=document.getElementById("coinCount");
    const before=parseInt((el.textContent+"").replace(/\D/g,""))||0;
    gsap.fromTo({v:before},{v:newTotal,duration:.8,snap:{v:1},onUpdate(){el.textContent=this.targets()[0].v;},onComplete(){gsap.fromTo("#coinPill",{scale:1},{scale:1.12,duration:.18,yoyo:true,repeat:1})}});
    document.getElementById("shopCoins").textContent=newTotal;
  }

  function loadUserData(){
    db.ref("users/"+uid).once("value",snap=>{
      const d=snap.val()||{};
      coins=d.coins||0;
      streak=d.streak||0;
      document.getElementById("coinCount").textContent=coins;
      document.getElementById("shopCoins").textContent=coins;
      document.getElementById("streakDays").textContent=streak;
      document.getElementById("streakLabel").textContent=streak==1?"day":"days";
      if(d.badges)renderBadges(d.badges); else renderBadges({});
      renderPfp(d.pfp||"üê∞");
      renderMot();
    });
  }

  function awardCoins(x){coins+=x;db.ref("users/"+uid).update({coins});animateCoins(coins);}
  function addStreak(){streak++;db.ref("users/"+uid).update({streak,lastCheck:today});document.getElementById("streakDays").textContent=streak;document.getElementById("streakLabel").textContent=streak==1?"day":"days";}
  function saveNickname(){nickname=document.getElementById("nickInput").value.trim();localStorage.setItem("nick",nickname)}
  document.getElementById("saveNickBtn").onclick=saveNickname;
  const FULL_PROMPTS=[
"Imagine your body's cells cheering you on. What are they saying about your choice to quit?",
"Describe what true freedom from nicotine addiction feels like. Where are you and what are you doing?",
"What's one sport, hobby, or creative pursuit that will get significantly better once your lungs are clear?",
"Write a short letter to your past self who first considered vaping. What warning and encouragement do you give?",
"List three specific ways quitting will improve your relationships with friends or family?",
"If you save the money you would have spent on vapes for a year, what exciting thing could you buy or do?",
"What is the main source of strength (internal or external) you will tap into when a craving is intense?",
"How does quitting show the world that you are disciplined and in control of your own life?",
"Describe the feeling of taking a full, deep, easy breath. Make it your motivation.",
"What new, positive identity are you stepping into by becoming a non-vaper?",
"Write down your core values (e.g., integrity, health, excellence). How does quitting align with them?",
"What's one thing you are truly excited about doing once you no longer worry about vaping?",
"Fill in the blank: I deserve to be nicotine-free because...",
"Choose a personal quit anthem and write about why its message motivates you.",
"If you could have a five-minute chat with your future self (vape-free), what advice would they give you?",
"Name your top three triggers (People, Places, Situations). Plan one avoidance or substitution for each.",
"What are the 3 P‚Äôs that trigger you most: People, Places, or Patterns?",
"You get a strong craving at a usual time. Write out the 5-step distraction routine you will execute immediately.",
"What specific feeling (boredom, social anxiety, stress) usually precedes the urge to vape? How can you address the feeling directly?",
"Design a Craving Kit. What five physical objects will you keep with you to replace the hand-to-mouth habit?",
"You‚Äôre offered a vape at a social event. Write down the exact line you will use to say, 'No, thanks' confidently.",
"What's one thing you can physically remove from your room or environment to make quitting easier?",
"How will you change your routine (e.g., taking a different route, switching lunch tables) to disrupt your habit loops?",
"List three safe people you can text or call when a craving is unbearable. Write down what you'll say to them.",
"Describe the feeling of a craving‚Äîis it a tightness, a restlessness, a hollow spot? Giving it a label makes it less scary.",
"When you feel the urge, what can you hold in your hand to keep it busy and mimic the vape's action?",
"If you usually vape after dinner, what is your new, non-negotiable after-dinner activity for the next week?",
"What are three ways you can make the people, places, and things that trigger you less accessible?",
"Plan a 'Fire Drill': If you unexpectedly run into a major trigger, what's your immediate 'Escape' strategy?",
"How does your understanding of your triggers make you feel more powerful and prepared?",
"What is your go-to breathing exercise when stress builds up? Write down the steps and practice it now.",
"Write down three positive affirmations about your strength and commitment. Read them out loud.",
"When you feel irritable or moody (nicotine withdrawal), what is a healthy, calming activity you can do for 15 minutes?",
"Describe a time in your life when you overcame a difficult challenge. What skills did you use then that you can use now?",
"If your craving felt like a stormy cloud, what's your mental 'sunshine' (a happy memory or thought) to cut through it?",
"What's one thing you can do for self-care today that has absolutely nothing to do with quitting?",
"When boredom hits, what is a productive task you can switch to that requires your full focus?",
"What's the difference between the temporary relief of vaping and the lasting calm of a healthy coping skill?",
"How can you talk to yourself with kindness and encouragement instead of self-criticism during a tough moment?",
"What is one positive habit (e.g., drinking water, stretching, listening to music) you want to add to your routine to replace vaping?",
"Write about an emotion you tend to avoid by vaping. How can you face that emotion directly for five minutes today?",
"What does 'riding the wave' of a craving mean to you? How does knowing it will pass in minutes change how you respond?",
"List five things that bring you genuine joy (not temporary distraction). Plan to do one today.",
"How does movement (walking, dancing, jumping jacks) help you release the physical tension of a craving?",
"What makes you laugh? Write about a funny memory or joke to shift your mood quickly?",
"What is the longest time you've gone without vaping so far? How does that prove you have the ability to quit?",
"List three small victories from the past 24 hours.",
"Describe one positive physical change you‚Äôve noticed (e.g., easier to breathe, better sense of smell, less coughing).",
"If your quit journey was climbing a mountain, what milestone have you reached, and what‚Äôs your next flag to plant?",
"How does successfully getting through a day without vaping make you feel proud of yourself?",
"Calculate the money you've saved so far. How will you reward yourself when you hit a major savings goal?",
"What's one new thing you've learned about your willpower or strength since you started this journey?",
"Write a celebratory headline for a news story about your success at the end of this week.",
"What have you accomplished today that a week ago you might have felt was impossible?",
"Name a craving you successfully resisted. What was the key strategy you used that worked?",
"How has your focus or sleep improved since you cut back or quit? Give a specific example?",
"Write down your next big reward (e.g., a concert ticket, new video game) and what vape-free date you will earn it by?",
"If your motivation was a battery, what charged it up today?",
"Who is the first person you want to share your next vape-free milestone with, and why?",
"What is the best piece of positive feedback you've received about your quitting journey?",
"Who is your #1 support person? Write a brief thank-you to them for their help?",
"How can you clearly communicate your needs to friends who still vape around you (e.g., 'Please don't do that when I'm here')?",
"What will you say to a friend who is also trying to quit but is struggling? Write a motivational message.",
"Imagine you are counseling another teen. What are the three most important pieces of advice you would give them?",
"How does your choice to quit influence the people around you in a positive way?",
"What's one thing you can do to find new, healthy social activities that don't involve vaping?",
"List three ways you can connect with people without relying on a shared habit like vaping?",
"How does being honest with a trusted adult about your quitting process make the challenge feel lighter?",
"Think about your favorite teacher or mentor. How would their belief in you fuel your decision to stay quit?",
"What are your healthy boundary words? (e.g., 'I'm committed to my health now' or 'Not today')",
"If you had a slip-up, write about it without judgment. What was the trigger, and what is the lesson learned?",
"What is one thing about quitting that has been easier than you expected? Why do you think that is?",
"How can you use the saved money to invest in a new skill or hobby?",
"If a moment of doubt hits, what is the most logical counter-argument to the desire to vape?",
"Write about a negative thought you keep having (e.g., 'It's too hard'). Now, rewrite it as an empowering truth.",
"What is the smallest, simplest thing you can do right now to make your quit journey a little easier?",
"What is one good thing that came out of a moment of discomfort during your quitting process?",
"If you could press a 'reset button' on a tough moment today, what would you change about your reaction?",
"What's one unexpected thing that makes you want to vape that you need to be mindful of?",
"Write a commitment to yourself about not letting one mistake erase all your progress.",
"Today, I choose...",
"My current superpower is my ability to...",
"I am strong enough to handle this craving because...",
"This craving is a sign that my body is healing.",
"The best thing about today was that I...",
"I will show myself compassion by...",
"What is a personal mantra you can say when you feel doubt?",
"I am worthy of a healthy life.",
"I feel the most like myself when I am...",
"What is one thing you can let go of today (a worry, a frustration)?",
"I am more than my habit.",
"My health is my priority.",
"What is one thing you are curious about learning or doing this week?",
"I forgive myself for any past mistakes and focus on today.",
"My commitment is stronger than any craving.",
"What are you looking forward to most this weekend, now that you're focused on being vape-free?",
"I am in control of my choices.",
"What simple action can you take in the next 5 minutes to feel better right now?",
"My lungs are strong and getting stronger every day.",
"I am a non-vaper. Write a final statement of power and belief."
  ];

  let PROMPTS=FULL_PROMPTS.slice();
  let promptIndex=0;
  const promptTextEl=document.getElementById("promptText");
  function showPrompt(){promptTextEl.textContent=PROMPTS[promptIndex]}
  document.getElementById("prevPrompt").onclick=()=>{promptIndex=(promptIndex-1+PROMPTS.length)%PROMPTS.length;showPrompt()};
  document.getElementById("nextPrompt").onclick=()=>{promptIndex=(promptIndex+1)%PROMPTS.length;showPrompt()};
  showPrompt();

  document.getElementById("clearJournalDraft").onclick=()=>{document.getElementById("journalEntry").value=""};
  document.getElementById("saveJournalBtn").onclick=()=>{
    const entry=document.getElementById("journalEntry").value.trim();
    if(!entry){document.getElementById("saveJournalMsg").textContent="Write something first";return;}
    const free=document.getElementById("freeWriteToggle").checked;
    const usePrompt=free?null:PROMPTS[promptIndex];
    const key=Date.now();
    db.ref("journal/"+uid+"/"+key).set({entry,prompt:usePrompt,ts:Date.now()});
    awardCoins(7);
    document.getElementById("journalEntry").value="";
    document.getElementById("saveJournalMsg").textContent="Saved! +7 coins";
    setTimeout(()=>document.getElementById("saveJournalMsg").textContent="",1600);
    if(usePrompt){
      const ul=document.getElementById("journalHistory");
      const li=document.createElement("li");li.textContent=usePrompt;ul.prepend(li);
      document.getElementById("journalHistoryCard").style.display="block";
    }
  };

  const mot={
    gentle:["You‚Äôve already proven you can do hard things.","Slip-ups don‚Äôt erase progress. They teach you.","Breathe. This urge will pass.","Talk to yourself like you would to a best friend.","Tiny wins today become big wins later."],
    firey:["Cravings don‚Äôt control you.","You‚Äôre choosing discipline over comfort.","Pain is temporary, power is permanent.","Show the world your backbone.","Wanting and doing are different. Do it."],
    mix:["Reset is always one choice away.","Every check-in is proof you care.","One day at a time beats all-or-nothing.","Replace the habit: move, sip water, breathe.","You‚Äôre stronger than this moment."]
  };

  function renderMot(){
    const grid=document.getElementById("stickyGrid");
    grid.innerHTML="";
    const picks=[...mot[mode]].slice(0,8);
    picks.forEach(txt=>{
      const d=document.createElement("div");
      d.className="sticky "+(mode==="firey"?"firey":mode==="mix"?"mix":"");
      d.textContent=txt;
      grid.appendChild(d);
      gsap.fromTo(d,{opacity:0,y:12},{opacity:1,y:0,duration:.25});
    });
  }
  document.getElementById("motivationStyle").value=mode;
  document.getElementById("saveStyleBtn").onclick=()=>{mode=document.getElementById("motivationStyle").value;localStorage.setItem("motStyle",mode);renderMot()};
  renderMot();
  function grantBadge(key,label,note){
    const ref=db.ref("users/"+uid+"/badges");
    ref.once("value",s=>{
      const cur=s.val()||{};
      if(!cur[key]){cur[key]={label:label,ts:Date.now()};ref.set(cur);openCelebration("You unlocked: "+label,note||"");}
      renderBadges(cur);
    });
  }
  function renderBadges(owned){
    const grid=document.getElementById("badgeGrid");grid.innerHTML="";
    const keys=Object.keys(owned||{});
    if(!keys.length){grid.innerHTML='<div class="muted">No badges yet. Your first one appears when you check in today.</div>';return;}
    keys.forEach(k=>{const c=document.createElement("div");c.className="badge";c.innerHTML='<div style="font-size:22px;margin-bottom:6px;">üèÖ</div><div><strong>'+(owned[k].label||k)+'</strong></div>';grid.appendChild(c);});
  }
  const PFP=["üê∂","üê∞","üê±","ü¶ä","üêª","üêº","üê®","üêµ","ü¶Ñ","üêØ","üêπ","üê∏","üê•","ü¶ã"];
  function renderPfp(sel){
    const holder=document.getElementById("pfpGrid");holder.innerHTML="";
    const chosen=sel||"üê∞";
    PFP.forEach(ch=>{
      const d=document.createElement("div");
      d.className="pfp-choice"+(chosen===ch?" active":"");
      d.textContent=ch;
      d.onclick=()=>{db.ref("users/"+uid).update({pfp:ch});renderPfp(ch);};
      holder.appendChild(d);
    });
  }
  function badgeName(k){if(k==="day1")return"First Day Smoke-Free";if(k==="week1")return"First Week Smoke-Free";if(k==="month1")return"1 Month Smoke-Free";if(k==="month6")return"6 Months Smoke-Free";if(k==="year1")return"1 Year Smoke-Free";return k}

  function buyItem(type,key,cost){
    if(coins<cost){document.getElementById("shopMsg").textContent="Not enough coins.";return;}
    coins-=cost;db.ref("users/"+uid).update({coins});animateCoins(coins);
    if(type==="theme"){localStorage.setItem("theme",key);document.body.setAttribute("data-theme",key);}
    if(type==="badge"){grantBadge(key,badgeName(key));}
    document.getElementById("shopMsg").textContent="Purchased "+type+"!";
  }
  document.querySelectorAll('.buyBtn').forEach(b=>{b.addEventListener('click',()=>buyItem(b.dataset.type,b.dataset.key,Number(b.dataset.cost)))})

  function applyCustomTheme(){
    const canByStreak=streak>=2;
    const hasCoins=coins>=10;
    if(!canByStreak&&!hasCoins){document.getElementById("ctMsg").textContent="Need 10 coins or a 2-day streak to apply a custom theme.";return;}
    if(!canByStreak){coins-=10;db.ref("users/"+uid).update({coins});animateCoins(coins);}
    const bg1=document.getElementById("ctBg1").value;
    const bg2=document.getElementById("ctBg2").value;
    const brand=document.getElementById("ctBrand").value;
    const brandDark=document.getElementById("ctBrandDark").value;
    document.body.style.setProperty('--bg1',bg1);
    document.body.style.setProperty('--bg2',bg2);
    document.body.style.setProperty('--brand',brand);
    document.body.style.setProperty('--brand-dark',brandDark);
    localStorage.setItem("theme_custom",JSON.stringify({bg1,bg2,brand,brandDark}));
    document.body.removeAttribute("data-theme");
    document.getElementById("ctMsg").textContent="Custom theme applied!";
  }
  document.getElementById("applyCustomThemeBtn").onclick=applyCustomTheme;

  function openCelebration(t,s){
    document.getElementById("celeTitle").textContent=t;
    document.getElementById("celeSub").textContent=s;
    document.getElementById("celeOverlay").classList.add("show");
    confetti({particleCount:140,spread:80,origin:{y:.7}});
    gsap.fromTo(".cele-card",{scale:.95,opacity:0,y:12},{scale:1,opacity:1,y:0,duration:.25});
  }
  document.getElementById("celeClose").onclick=()=>{document.getElementById("celeOverlay").classList.remove("show")}
  document.getElementById("celeOverlay").addEventListener("click",e=>{if(e.target.id==="celeOverlay"){document.getElementById("celeOverlay").classList.remove("show")}})

  function saveCheckin(){
    db.ref("users/"+uid).once("value",snap=>{
      const d=snap.val()||{};
      if(d.lastCheck===today){document.getElementById("checkinMsg").textContent="You already checked in today. Come back tomorrow!";return;}
      const cravings=document.getElementById("craveSel").value;
      const vaped=document.getElementById("vapedSel").value;
      const y=d.lastCheck||null;
      const yest=new Date();yest.setDate(yest.getDate()-1);
      const yKey=yest.toISOString().slice(0,10);
      let s=d.streak||0;
      if(y===yKey)s=Math.max(1,s)+1; else s=1;
      streak=s;
      let earned=5;if(vaped==='no')earned+=10;if(cravings==='none')earned+=5;
      coins=(d.coins||0)+earned;
      db.ref("users/"+uid).update({streak:s,coins,lastCheck:today});
      animateCoins(coins);
      document.getElementById("streakDays").textContent=s;
      document.getElementById("streakLabel").textContent=s===1?"day":"days";
      if(s===1)grantBadge("day1","First Day Smoke-Free","Starting is the hardest step ‚Äî you just did it.");
      if(s===7)grantBadge("week1","First Week Smoke-Free","Seven days strong. Keep going!");
      if(s===30)grantBadge("month1","1 Month Smoke-Free","This is a huge milestone. Proud of you!");
      if(s===180)grantBadge("month6","6 Months Smoke-Free","Half a year! Incredible consistency.");
      if(s===365)grantBadge("year1","1 Year Smoke-Free","An entire year. You did that.");
      if(s>=2)openCelebration("You're on a roll!","Streak: "+s+" "+(s===1?"day":"days")+".");
      if(vaped==='no')openCelebration("Great job!","Saved! You earned +"+earned+" coins.");
      else openCelebration("It‚Äôs okay ‚Äî reset starts now","Slip-ups happen. You‚Äôre still in this.");
      document.getElementById("checkinMsg").textContent="Saved! You earned +"+earned+" coins.";
      setTimeout(()=>document.getElementById("checkinMsg").textContent="",2200);
    });
  }
  document.getElementById("saveCheckinBtn").onclick=saveCheckin;

  function loadChat(){
    const box=document.getElementById("chatBox");box.innerHTML="";
    const ref=db.ref("chat/global");
    ref.limitToLast(100).on("child_added",snap=>{
      const m=snap.val()||{};
      const div=document.createElement("div");
      div.className="msg";
      const when=new Date(m.ts||Date.now()).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
      div.innerHTML="<small>["+when+"] "+escapeHtml(m.nick||"anon")+":</small> "+escapeHtml(m.text||"");
      box.appendChild(div);box.scrollTop=box.scrollHeight;
    });
  }
  function sendMsg(){
    const text=document.getElementById("chatMsg").value.trim();if(!text)return;
    const ref=db.ref("chat/global");
    const nick=(nickname||document.getElementById("nickInput").value.trim()||"anon").slice(0,24);
    ref.push({nick,text,ts:Date.now()}).then(()=>{
      document.getElementById("chatMsg").value="";
      const key="msg_count_"+today;
      const sent=Number(localStorage.getItem(key)||0);
      if(sent<3&&text.length>=12){awardCoins(2);localStorage.setItem(key,sent+1);}
    }).catch(err=>alert("Send failed: "+err.message));
  }
  document.getElementById("sendBtn").onclick=sendMsg;
  document.getElementById("chatMsg").addEventListener("keydown",e=>{if(e.key==="Enter"){e.preventDefault();sendMsg();}});

  function escapeHtml(s){return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}

  Array.from(document.querySelectorAll("button")).forEach(btn=>{btn.addEventListener("click",()=>{gsap.fromTo(btn,{scale:1},{scale:.92,duration:.12,yoyo:true,repeat:1})})});

  document.querySelectorAll('.link[data-jump]').forEach(el=>el.addEventListener('click',()=>show(el.dataset.jump)));

  function applyFontChoice(fontName){document.documentElement.style.setProperty('--app-font',fontName);localStorage.setItem('font_choice',fontName)}
  function renderFontPicker(){
    const chips=document.querySelectorAll('.font-chip');
    const chosen=localStorage.getItem('font_choice')||'"Hanken Grotesk"';
    applyFontChoice(chosen);
    chips.forEach(c=>{
      c.classList.toggle('active',c.dataset.font===chosen);
      c.addEventListener('click',()=>{chips.forEach(x=>x.classList.remove('active'));c.classList.add('active');applyFontChoice(c.dataset.font)});
    });
  }
  renderFontPicker();
  (function applySavedTheme(){
    const t=localStorage.getItem('theme');
    const custom=localStorage.getItem('theme_custom');
    if(custom){
      const obj=JSON.parse(custom);
      document.body.style.setProperty('--bg1',obj.bg1);
      document.body.style.setProperty('--bg2',obj.bg2);
      document.body.style.setProperty('--brand',obj.brand);
      document.body.style.setProperty('--brand-dark',obj.brandDark);
      document.body.removeAttribute('data-theme');
    }else if(t){
      document.body.setAttribute('data-theme',t);
    }
  })();

  document.getElementById("coinCount").textContent=coins;
  document.getElementById("shopCoins").textContent=coins;
  document.querySelectorAll('.section')[0].classList.add('active');
});
</script>
</body>
</html>